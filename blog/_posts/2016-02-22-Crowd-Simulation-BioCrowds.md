---
categories: blog 2016 02 22
excerpt: Some thoughts about implementing BioCrowds by rasterizing marker density fields on a grid to enhance agent collision avoidance. Inspired much by PIC/FLIP fluids
title: Crowd Simulation and Implementing BioCrowds on a Uniform Grid
---

<p>For my seminar on crowd simulation, CIS 700, we've been implementing various SIGGRAPH papers on steering. The one I chose is <a href="http://www.sciencedirect.com/science/article/pii/S0097849311001713">BioCrowds</a>, a fairly unique and interesting approach to solving collision avoidance. However, I think the coolest part about this opportunity is that one of the authors of the paper itself is assisting in teaching the class! This class in general is one of the most unique class experiences I've had. There are about 10 students and 5 professors. 2:1 student-faculty ratio. Straight out of a college brochure. Because multiple students want to work on BioCrowds, we've been asked to take different approaches/adaptations to the paper. I've decided to work on extending BioCrowds to deal better with long-range collision avoidance and other scenarios which cause agents to get stuck.</p>

<h2>Background</h2>
<p>The original paper is inspired by venation patterns in leaves. Veins branch outward without intersection and maintain a reasonable amount of distance from each other. The goal was to have agent behavior mimic the paths that leaf veins form. To accomplish this, "markers" are points that are scattered all over the ground plane in regions that agents are permitted to walk. These represent candidate directions or locations that agents can travel in. In order to prevent collisions and mimic the spacing of leaf veins, markers are associated with the agent nearest to them (within a certain radius). This is very much like a voronoi diagram. Vectors from each agent to his respective markers are summed according to their component parallel to the agent's goal vector in order to determine an agent's velocity. Since markers can only be "owned" by one agent, there is a barrier between the markers of two agents that walk close to each other, preventing them colliding.</p>

<h2>Improving Long Range Collision Avoidance</h2>
<p>While the original algorithm works very well in many cases, it still has a couple of shortcomings. The agent's marker radius is limited so agents do not begin to avoid obstacles until they become near enough. Though this may work well for dense crowds, in sparse regions, real people typically gradually avoid other agents and obstacles. Secondly, agents can have a difficult time navigating around large obstacles. If none of their markers lead them around a certain obstacle, then they will simply walk up to it and stop.</p>

<p>Currently, I am also taking a class on Physics Based Animation, so the idea of projecting particle attributes onto a grid as done in PIC/FLIP systems has been stuck in my head. My idea is to introduce forces into the BioCrowds model. More specifically, density fields could determine how many markers get distributed in what regions. This could be done manually, but the hope is to accomplish this dynamically, allowing the model to have better prediction for moving agents and obstacles. Obstacles and other agents would emit a negative density field which would restrict markers from being distributed in that region. By doing this, we reduce the drastic change from no markers inside an obstacle to dense markers outside the obstacle. A more gradual change will hopefully slowly direct the agent around the obstacle. I also plan to increase each agent's marker search radius, but weight the marker influencs by how far they are from the agent. This will allow the model to continue to respond quickly to nearby obstacles, but also slowly veer away as they encounter obstacles at a distance.</p>